{% for claim in claims %}
<tr class="claim-row" data-claim-id="{{ claim.id }}" style="
  border-bottom: 1px solid #e9ecef;
  transition: background-color 0.3s ease;
" onmouseover="this.style.backgroundColor='#f8f9fa'" onmouseout="this.style.backgroundColor='white'">
  <td style="padding: 15px; font-weight: 600; color: #2d5a5a;">{{ claim.id }}</td>
  <td style="padding: 15px; color: #333;">{{ claim.patient_name }}</td>
  <td style="padding: 15px; color: #333;">{{ claim.insurer_name }}</td>
  <td style="padding: 15px;">
    <span class="status-badge status-{{ claim.status|lower|cut:' ' }}" style="
      padding: 6px 12px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      {% if claim.status == 'Denied' %}
        background: #f8d7da;
        color: #721c24;
      {% elif claim.status == 'Paid' %}
        background: #d4edda;
        color: #155724;
      {% elif claim.status == 'Under Review' %}
        background: #fff3cd;
        color: #856404;
      {% elif claim.status == 'Underpaid' %}
        background: #d1ecf1;
        color: #0c5460;
      {% else %}
        background: #e2e3e5;
        color: #383d41;
      {% endif %}
    ">{{ claim.status }}</span>
  </td>
  <td style="padding: 15px; text-align: right; color: #333; font-weight: 600;">${{ claim.billed_amount|floatformat:2 }}</td>
  <td style="padding: 15px; text-align: right; color: #333; font-weight: 600;">${{ claim.paid_amount|floatformat:2 }}</td>
  <td style="padding: 15px; text-align: right; color: #dc3545; font-weight: 600;">${{ claim.underpayment|floatformat:2 }}</td>
  <td style="padding: 15px; text-align: center;">
    <div class="action-icons" style="display: flex; gap: 8px; justify-content: center;">
      <button onclick="viewFlags({{ claim.id }})" title="View Flags" style="
        background: none;
        border: none;
        cursor: pointer;
        padding: 5px;
        border-radius: 5px;
        transition: all 0.3s ease;
        color: #dc2626;
      " onmouseover="this.style.backgroundColor='#fef2f2'; this.style.transform='scale(1.2)'" 
         onmouseout="this.style.backgroundColor='transparent'; this.style.transform='scale(1)'">
        <svg xmlns="http://www.w3.org/2000/svg" class="lucide lucide-flag" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M4 15s1-1 3-1 5 2 8 2 4-1 3-1V3s-1 1-3 1-5-2-8-2-4 1-3 1z"/>
          <line x1="4" x2="4" y1="22" y2="15"/>
        </svg>
      </button>
      
      <button onclick="addFlag({{ claim.id }})" title="Add Flag" style="
        background: none;
        border: none;
        cursor: pointer;
        padding: 5px;
        border-radius: 5px;
        transition: all 0.3s ease;
        color: #16a34a;
      " onmouseover="this.style.backgroundColor='#f0fdf4'; this.style.transform='scale(1.2)'" 
         onmouseout="this.style.backgroundColor='transparent'; this.style.transform='scale(1)'">
        <svg xmlns="http://www.w3.org/2000/svg" class="lucide lucide-plus" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="5" x2="12" y2="19"/>
          <line x1="5" y1="12" x2="19" y2="12"/>
        </svg>
      </button>
      
      <button onclick="viewDetails({{ claim.id }})" title="View Details" style="
        background: none;
        border: none;
        cursor: pointer;
        padding: 5px;
        border-radius: 5px;
        transition: all 0.3s ease;
        color: #2563eb;
      " onmouseover="this.style.backgroundColor='#eff6ff'; this.style.transform='scale(1.2)'" 
         onmouseout="this.style.backgroundColor='transparent'; this.style.transform='scale(1)'">
        <svg xmlns="http://www.w3.org/2000/svg" class="lucide lucide-eye" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
          <circle cx="12" cy="12" r="3"/>
        </svg>
      </button>
      
      <button onclick="showNoteForm({{ claim.id }})" title="Add Notes" style="
        background: none;
        border: none;
        cursor: pointer;
        padding: 5px;
        border-radius: 5px;
        transition: all 0.3s ease;
        color: #7c3aed;
      " onmouseover="this.style.backgroundColor='#faf5ff'; this.style.transform='scale(1.2)'" 
         onmouseout="this.style.backgroundColor='transparent'; this.style.transform='scale(1)'">
        <svg xmlns="http://www.w3.org/2000/svg" class="lucide lucide-file-text" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
          <polyline points="14,2 14,8 20,8"/>
          <line x1="16" x2="8" y1="13" y2="13"/>
          <line x1="16" x2="8" y1="17" y2="17"/>
          <line x1="10" x2="8" y1="9" y2="9"/>
        </svg>
      </button>
    </div>
  </td>
</tr>

<!-- Expandable Details Row -->
<tr class="claim-details-row" id="details-{{ claim.id }}" style="display: none;">
  <td colspan="8" style="padding: 0;">
    <div class="details-content" style="
      background: #f8f9fa;
      padding: 20px;
      border-top: 2px solid #e9ecef;
    ">
      <div class="details-grid" style="
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
      ">
        <!-- Claim Details -->
        <div class="detail-section claim-info-section">
          <h4 style="color: #2d5a5a; margin-bottom: 15px; font-size: 16px;">üìã Claim Information</h4>
          <div class="detail-item" style="margin-bottom: 10px;">
            <strong style="color: #333;">Discharge Date:</strong> 
            <span style="color: #666;">{{ claim.discharge_date|date:"M d, Y" }}</span>
          </div>
          <div class="detail-item" style="margin-bottom: 10px;">
            <strong style="color: #333;">Underpayment:</strong> 
            <span style="color: #dc3545; font-weight: 600;">${{ claim.underpayment|floatformat:2 }}</span>
          </div>
        </div>
        
        <!-- Denial Reason and CPT Codes -->
        <div class="detail-section medical-details-section">
          <h4 style="color: #2d5a5a; margin-bottom: 15px; font-size: 16px;">üè• Medical Details</h4>
          <div class="detail-item" style="margin-bottom: 10px;">
            <strong style="color: #333;">Denial Reason:</strong> 
            <span style="color: #666;">{{ claim.detail.denial_reason|default:"Not specified" }}</span>
          </div>
          <div class="detail-item" style="margin-bottom: 10px;">
            <strong style="color: #333;">CPT Codes:</strong> 
            <span style="color: #666;">{{ claim.detail.cpt_codes|default:"Not specified" }}</span>
          </div>
        </div>
        
        <!-- Flags Section -->
        <div class="detail-section flags-section">
          <h4 style="color: #2d5a5a; margin-bottom: 15px; font-size: 16px;">üö© Flags</h4>
          <div id="flags-{{ claim.id }}" class="flags-list">
            {% for flag in claim.flags.all %}
            <div class="flag-item" style="
              background: white;
              padding: 10px;
              border-radius: 8px;
              margin-bottom: 8px;
              border-left: 3px solid #dc3545;
            ">
              <div style="color: #666; font-size: 12px; margin-bottom: 5px;">
                {{ flag.created_at|date:"M d, Y H:i" }}
              </div>
              <div style="color: #333;">Flagged by: {{ flag.created_by|default:"System" }}</div>
            </div>
            {% empty %}
            <div style="color: #999; font-style: italic;">No flags yet</div>
            {% endfor %}
          </div>
        </div>
        
        <!-- Notes Section -->
        <div class="detail-section notes-section">
          <h4 style="color: #2d5a5a; margin-bottom: 15px; font-size: 16px;">üìù Notes</h4>
          <div id="notes-{{ claim.id }}" class="notes-list">
            {% for note in claim.notes.all %}
            <div class="note-item" style="
              background: white;
              padding: 10px;
              border-radius: 8px;
              margin-bottom: 8px;
              border-left: 3px solid #2d5a5a;
            ">
              <div style="color: #666; font-size: 12px; margin-bottom: 5px;">
                {{ note.created_at|date:"M d, Y H:i" }}
              </div>
              <div style="color: #333;">{{ note.text }}</div>
            </div>
            {% empty %}
            <div style="color: #999; font-style: italic;">No notes yet</div>
            {% endfor %}
          </div>
        </div>
      </div>
      
      <!-- Close Button -->
      <div style="text-align: center; margin-top: 20px;">
        <button onclick="hideDetails({{ claim.id }})" style="
          background: linear-gradient(135deg, #6c757d, #5a6268);
          color: white;
          border: none;
          padding: 10px 20px;
          border-radius: 20px;
          cursor: pointer;
          font-size: 14px;
          font-weight: 500;
          transition: all 0.3s ease;
        " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
          ‚úï Close Details
        </button>
      </div>
    </div>
  </td>
</tr>
{% endfor %}
